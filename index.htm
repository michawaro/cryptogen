// Solution pour corriger le bouton "Enregistrer" du pixel editor
// Remplacez votre fonction savePixelArt() actuelle par cette version

async function savePixelArt() {
  // Vérifier si le dessin existe
  if (!hasPixelArtDrawing()) {
    alert("Aucun dessin à enregistrer !");
    return;
  }

  try {
    // Convertir le pixel art en séquence FASTA (ou autre format selon votre besoin)
    const fastaSequence = convertPixelArtToFasta();
    
    // Créer un Blob avec le contenu
    const blob = new Blob([fastaSequence], { type: 'text/plain' });
    
    // Créer un lien de téléchargement
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'pixel-art.fasta'; // Nom du fichier
    link.style.display = 'none';
    
    // Ajouter au DOM, cliquer, puis supprimer
    document.body.appendChild(link);
    
    // Utiliser un événement tactile pour mobile/tablette
    if ('ontouchstart' in window) {
      // Pour mobile/tablette : utiliser touchstart
      link.addEventListener('touchstart', function() {
        link.click();
      }, { once: true });
    }
    
    // Déclencher le téléchargement
    link.click();
    
    // Nettoyer après un court délai
    setTimeout(() => {
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }, 100);
    
  } catch (error) {
    console.error('Erreur lors de l\'enregistrement:', error);
    alert('Erreur lors de l\'enregistrement du fichier.');
  }
}

// Fonction pour vérifier si un dessin existe
function hasPixelArtDrawing() {
  if (pixelArtGrid.length === 0) return false;
  
  for (let i = 0; i < pixelArtGrid.length; i++) {
    if (!pixelArtGrid[i]) continue;
    for (let j = 0; j < pixelArtGrid[i].length; j++) {
      if (pixelArtGrid[i][j] !== undefined && pixelArtGrid[i][j] !== 0) {
        return true; // Au moins un pixel n'est pas blanc
      }
    }
  }
  return false; // Tous les pixels sont blancs
}

// Fonction pour convertir le pixel art en séquence FASTA
function convertPixelArtToFasta() {
  // Votre logique de conversion existante
  // Cette fonction doit retourner la séquence FASTA sous forme de string
  // Exemple basique :
  let sequence = '';
  // ... votre code de conversion ...
  return sequence;
}

// Amélioration du bouton pour mobile/tablette
// Ajoutez ce code après la création du bouton dans votre HTML/JS

function setupSaveButton() {
  const saveBtn = document.getElementById('savePixelArtBtn');
  if (!saveBtn) return;
  
  // S'assurer que le bouton est cliquable sur mobile
  saveBtn.style.touchAction = 'manipulation';
  saveBtn.style.cursor = 'pointer';
  saveBtn.style.userSelect = 'none';
  saveBtn.style.webkitTapHighlightColor = 'transparent';
  
  // Ajouter les événements pour mobile et desktop
  saveBtn.addEventListener('click', savePixelArt);
  saveBtn.addEventListener('touchend', function(e) {
    e.preventDefault();
    e.stopPropagation();
    savePixelArt();
  }, { passive: false });
  
  // Empêcher le double déclenchement
  let isSaving = false;
  const originalSave = savePixelArt;
  savePixelArt = async function() {
    if (isSaving) return;
    isSaving = true;
    try {
      await originalSave();
    } finally {
      setTimeout(() => { isSaving = false; }, 500);
    }
  };
}

// Appeler setupSaveButton() après le chargement de la page
// ou après l'ouverture du modal du pixel editor
